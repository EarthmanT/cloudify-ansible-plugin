tosca_definitions_version: cloudify_dsl_1_3

imports:
  - https://cloudify.co/spec/cloudify/6.3.0/types.yaml
  - plugin:cloudify-ansible-plugin

inputs:

  domain:
    type: string
    default: kdc.example.com

  user:
    type: string
    default: ansible



node_templates:

  example:
    type: cloudify.nodes.ansible.Executor
    properties:
      sources:
        vms:
          hosts:
            {  get_input: domain }:
              ansible_connection: winrm
              ansible_user: { get_input: user }
              ansible_password: { get_secret: kerb }
              ansible_winrm_transport: kerberos
              ansible_winrm_server_cert_validation: ignore
              ansible_port: 5985
      playbook_path: playbook.yml
      ansible_env_vars:
        ANSIBLE_INVALID_TASK_ATTRIBUTE_FAILED: "False"
        ANSIBLE_HOST_KEY_CHECKING: "False"
        ANSIBLE_STDOUT_CALLBACK: dense
      extra_packages:
        - pywinrm
        - pywinrm[kerberos]
      kerberos_config: krb.conf
