
imports:
  - http://www.getcloudify.org/spec/cloudify/3.1/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/1.1/plugin.yaml

inputs:
  
  package_name:
    default: "ansible"
    type: string

  package_manager_name:
    default: "apt-get"
    type: string

  new_host_name:
    type: string

  new_host_address:
    type: string

  new_playbook_name:
    default: "playbook"
    type: string

  path_to_new_playbook:
    type: string

node_types:

  ansible_manager:
    type: cloudify.nodes.ApplicationModule
      interfaces:
        cloudify.interfaces.lifecycle:
          install:
            implementation: ansible.main.install.install_package
              inputs:
                package: { get_input: package_name }
                 package_manager: { get_input: package_manager_name }
          add_production_host:
            implmentation: ansible.main.tasks.add_production_host
              inputs:
                host: { get_input: new_host_name }
                address: { get_input: new_host_address}
          add_playbook:
            implementation: ansible.main.tasks.add_playbook
              inputs:
                playbook: { get_inputs: new_playbook_name }
                entry: { get_input: local_path_to_playbook }
      relationships:
        - type: cloudify.relationships.contained_in
          target: manager_host