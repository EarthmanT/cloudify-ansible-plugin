# DSL version, should appear in the main blueprint.yaml
# and may appear in other imports. In such case, the versions must match
tosca_definitions_version: cloudify_dsl_1_0

imports:
    # importing cloudify related types, plugins, workflow, etc...
    # to speed things up, it is possible downloading this file,
    # including it in the blueprint directory and importing it
    # instead.
    - http://www.getcloudify.org/spec/cloudify/3.1/types.yaml
    # relative import of plugin.yaml that resides in the blueprint directory
    - test_plugin.yaml

inputs:
    # example input that could be injected by test\
    manager_ip:
        type: string
    package_name:
        default: "ansible"
        type: string

    package_manager_name:
        default: "apt-get"
        type: string

    new_host_name:
        type: string

    new_host_address:
        type: string

    new_playbook_name:
        default: "playbook"
        type: string

    path_to_new_playbook:
        type: string

node_templates:
    ansible_manager:
        type: cloudify.nodes.Compute
        properties:
            ip: { get_input: manager_ip }
        interfaces:
            cloudify.interfaces.lifecycle:
                install:
                    implementation: ansible.ansible_plugin.tasks.install_package
                    inputs:
                        package: { get_input: package_name }
                        package_manager: { get_input: package_manager_name }
                add_production_host:
                    implementation: ansible.ansible_plugin.tasks.add_production_host
                    inputs:
                        host: { get_input: new_host_name }
                        address: { get_input: new_host_address}
                add_playbook:
                    implementation: ansible.main.tasks.add_playbook
                    inputs:
                        playbook: { get_inputs: new_playbook_name }
                        entry: { get_input: local_path_to_playbook }
