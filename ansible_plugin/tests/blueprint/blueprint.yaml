tosca_definitions_version: cloudify_dsl_1_0

imports:
  - http://www.getcloudify.org/spec/cloudify/3.1/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/1.1/plugin.yaml

plugins:
  cloudify-ansible-plugin:
    executor: central_deployment_agent
    source: https://github.com/earthmant/cloudify-ansible-plugin/archive/New-Tasks.zip

inputs:

  agent_user:
    type: string
  image_name:
    type: string
  flavor_name:
    type: string
  test_group_name:
    type: string
  test_inventory_name:
    type: string
  where_to_get_the_playbook:
    type: string
  get_module_name:
    type: string
  get_module_args:
    type: string
  ansible_run_pattern:
    type: string
  ansible_forks:
    type: string
  agent_key_path:
    type: string

node_templates:

  ansible_configuration:
    type: cloudify.nodes.ApplicationModule
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: cloudify-ansible-plugin.ansible_plugin.configure.make_directories
        preconfigure:
          implementation: cloudify-ansible-plugin.ansible_plugin.configure.put_ansible_conf
        configure:
          implementation: cloudify-ansible-plugin.ansible_plugin.configure.validate
        postconfigure:
          implementation: cloudify-ansible-plugin.ansible_plugin.configure.hard_code_home

