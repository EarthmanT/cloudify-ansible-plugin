tosca_definitions_version: cloudify_dsl_1_0

imports:
    - http://www.getcloudify.org/spec/cloudify/3.1/types.yaml

plugins:
  ansible:
    executor: central_deployment_agent

inputs:
    manager_ip:
        type: string
    package_name:
        default: "ansible"
        type: string

    package_manager_name:
        default: "apt-get"
        type: string

    new_host_name:
        type: string

    new_host_address:
        type: string

    new_playbook_name:
        default: "playbook"
        type: string

    path_to_new_playbook:
        type: string

node_templates:
    ansible_manager:
        type: cloudify.nodes.Compute
        interfaces:
            cloudify.interfaces.lifecycle:
                create:
                    implementation: ansible.ansible_plugin.install.install_package
                    inputs:
                        package: { get_input: package_name }
                        package_manager: { get_input: package_manager_name }
                add_production_host:
                    implementation: ansible.ansible_plugin.tasks.add_production_host
                    inputs:
                        host: { get_input: new_host_name }
                        address: { get_input: new_host_address}
                add_playbook:
                    implementation: ansible.main.tasks.add_playbook
                    inputs:
                        playbook: { get_inputs: new_playbook_name }
                        entry: { get_input: local_path_to_playbook }
