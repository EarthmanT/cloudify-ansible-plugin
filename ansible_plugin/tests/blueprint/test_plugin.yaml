tosca_definitions_version: cloudify_dsl_1_0

imports:
  - http://www.getcloudify.org/spec/cloudify/3.1/types.yaml
  - ../../../plugin.yaml

plugins:
  cloudify-ansible-plugin:
    executor: central_deployment_agent
    source: https://github.com/earthmant/cloudify-ansible-plugin/archive/master.zip
    install: false

inputs:

  test_host:
    default: ''
  test_group:
    default: ''
  test_inventory:
    default: ''
  test_playbook:
    default: ''
  test_key:
    default: ''

node_templates:

  target_host:
    type: cloudify.ansible.host
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: cloudify-ansible-plugin.ansible_plugin.tasks.add_host
          inputs:
            host: { get_input: test_host }
            group: { get_input: test_group }
            inventory: { get_input: test_inventory }

  test_playbook:
    type: cloudify.ansible.playbook
    interfaces:
      cloudify.interfaces.lifecycle:
        start:
          implementation: cloudify-ansible-plugin.ansible_plugin.tasks.run_playbook
          inputs:
            inventory: { get_input: test_inventory}
            local_file: { get_input: test_playbook }
            agent_key: { get_input: test_key }